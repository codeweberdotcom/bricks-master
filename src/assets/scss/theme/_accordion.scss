//----------------------------------------------------------//
//  ACCORDION
//----------------------------------------------------------//
// NOTE: Все переменные аккордеона находятся в _variables.scss
//----------------------------------------------------------//

// Классы для позиционирования иконки (убрали mixin, используем классы)

// Mixin для вертикального выравнивания иконки с поддержкой поворота
@mixin accordion-icon-transform($rotate: 0deg) {
  top: 50%;
  transform: translateY(-50%) rotate($rotate);
}

// В файле _accordion.scss замените соответствующие блоки:

.accordion-wrapper {
  .card {
    margin-bottom: $accordion-margin-bottom;

    &.plain {
      background: none;
      border: 0;
      border-width: $accordion-plain-border-width;
      border-style: $accordion-plain-border-style;
      border-color: $accordion-plain-border-color;
      margin-bottom: 0;
      box-shadow: none;

      // По умолчанию иконка слева (класс .icon-left)
      .card-body {
        padding: $accordion-card-body-padding-left;
      }

      .card-header {
        padding: $accordion-card-header-padding;

        button {
          padding: 0 0 0 1.2rem;
          position: relative;

          &:before {
            left: -0.3rem;
            right: auto;
            top: 50%;
            // Убрали transform отсюда, он будет в отдельных состояниях
          }

          // Увеличиваем специфичность для состояний
          &.collapsed:before {
            // Вариант с одной иконкой (поворот)
            @if $accordion-icon-type == "one" {
              content: $accordion-icon-one;
              transform: translateY(-50%) rotate($accordion-icon-closed-rotate);
            }
            // Вариант с двумя иконками (замена)
            @else {
              content: $accordion-icon-close;
              transform: translateY(-50%);
            }
          }

          &:not(.collapsed):before {
            // Вариант с одной иконкой (поворот)
            @if $accordion-icon-type == "one" {
              content: $accordion-icon-one;
              transform: translateY(-50%) rotate($accordion-icon-opened-rotate);
            }
            // Вариант с двумя иконками (замена)
            @else {
              content: $accordion-icon-open;
              transform: translateY(-50%);
            }
          }
        }
      }
    }
  }

  .card-header {
    position: relative;
    margin-bottom: 0;
    background: none;
    border: 0;
    padding: $accordion-card-header-padding-default;

    button {
      cursor: pointer;
      width: 100%;
      padding: .9rem 2.9rem .85rem;
      text-align: left;
      margin: 0;
      border: 0;
      @include font-size($accordion-button-font-size);
      font-weight: $accordion-button-font-weight;
      color: var(--#{$prefix}primary);
      @include transition(all 150ms ease-in-out);
      background: none;
      position: relative;
      min-height: 1.5rem;

      &:before {
        font-family: $font-family-unicons;
        position: absolute;
        @include font-size($accordion-icon-font-size);
        font-weight: normal;
        width: 1rem;
        display: inline-block;
        color: $accordion-icon-color;
        @include transition(all 0.25s ease);
        left: $accordion-button-icon-span;
        right: auto;
        top: 50%;
        // Базовый transform без поворота
        transform: translateY(-50%);
      }

      // Увеличиваем специфичность
      &.collapsed {
        color: $main-dark;

        &:before {
          // Вариант с одной иконкой (поворот)
          @if $accordion-icon-type == "one" {
            content: $accordion-icon-one;
            transform: translateY(-50%) rotate($accordion-icon-closed-rotate);
          }
          // Вариант с двумя иконками (замена)
          @else {
            content: $accordion-icon-close;
            transform: translateY(-50%);
          }
        }
      }

      &:not(.collapsed) {
        color: var(--#{$prefix}primary);

        &:before {
          // Вариант с одной иконкой (поворот)
          @if $accordion-icon-type == "one" {
            content: $accordion-icon-one;
            transform: translateY(-50%) rotate($accordion-icon-opened-rotate);
          }
          // Вариант с двумя иконками (замена)
          @else {
            content: $accordion-icon-open;
            transform: translateY(-50%);
          }
        }
      }

      &:hover {
        color: $accordion-button-hover-color;

        &:before {
          color: $accordion-icon-hover-color;
        }
      }
    }
  }
}

.accordion-item {
  .card-body {
    padding: $accordion-body-padding-default;
  }

  &.icon {
    .card-body {
      padding: 0 1.25rem 0.25rem 2.6rem;
    }

    button {
      padding: 0.9rem 2.6rem 0.85rem;
      display: flex;
      align-items: center;
      position: relative;

      &:before {
        display: none;
      }

      > .icon {
        position: absolute;
        left: 1.3rem;
        right: auto;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        justify-content: center;

        i {
          @include font-size($accordion-button-icon-font-size);
          line-height: 1;
        }
      }
    }
  }
}

//----------------------------------------------------------//
//  COLLAPSE
//----------------------------------------------------------//
.collapse-link {
  @include font-size(0.85rem);
  font-weight: $font-weight-bold;
  color: var(--#{$prefix}primary);
  position: relative;
  display: inline-flex;
  align-items: center;
  min-height: 1.5rem;
  
  &:before {
    font-family: $font-family-unicons;
    content: $icon-caret-up;
    @include font-size(1.15rem);
    font-weight: normal;
    width: 1rem;
    margin-left: -0.3rem;
    margin-right: 0.4rem;
    display: inline-block;
    line-height: 1;
    vertical-align: middle;
  }
  
  &.collapsed {
    color: $main-dark;
    
    &:before {
      content: $icon-caret-down;
    }
  }
  
  &:hover {
    color: var(--#{$prefix}primary);
  }
}

.accordion-collapse > .card-footer {
  background: $pre-bg;
  padding: 0;
}

//----------------------------------------------------------//
//  КЛАССЫ ДЛЯ ТИПОВ ИКОНОК
//----------------------------------------------------------//
.accordion-wrapper {
  // Тип 1 — стандартные стрелки (caret-up/caret-down)
  &.type-1 {
    .card.plain .card-header button {
      &.collapsed:before {
        content: $accordion-icon-close-type-1;
        transform: translateY(-50%);
      }
      &:not(.collapsed):before {
        content: $accordion-icon-open-type-1;
        transform: translateY(-50%);
      }
    }

    .card-header button {
      &.collapsed:before {
        content: $accordion-icon-close-type-1;
        transform: translateY(-50%);
      }
      &:not(.collapsed):before {
        content: $accordion-icon-open-type-1;
        transform: translateY(-50%);
      }
    }
  }

  // Тип 2 — кастомные иконки
  &.type-2 {
    .card.plain .card-header button {
      &.collapsed:before {
        content: $accordion-icon-close-type-2;
        transform: translateY(-50%);
      }
      &:not(.collapsed):before {
        content: $accordion-icon-open-type-2;
        transform: translateY(-50%);
      }
    }

    .card-header button {
      &.collapsed:before {
        content: $accordion-icon-close-type-2;
        transform: translateY(-50%);
      }
      &:not(.collapsed):before {
        content: $accordion-icon-open-type-2;
        transform: translateY(-50%);
      }
    }
  }

  // Тип 3 — одна иконка с поворотом
  &.type-3 {
    .card.plain .card-header button {
      // смещение иконки под тип-3
      &:before {
        left: -0.3rem;
        right: auto;
      }
      &.collapsed:before {
        content: $accordion-icon-one-type-3;
        transform: translateY(-50%) rotate($accordion-icon-type-3-closed-rotate);
      }
      &:not(.collapsed):before {
        content: $accordion-icon-one-type-3;
        transform: translateY(-50%) rotate($accordion-icon-type-3-opened-rotate);
        right: auto;
        left: -0.2rem;
      }
    }

    .card-header button {
      &:before {
        left: 1.3rem;
        right: auto;
      }
      &.collapsed:before {
        content: $accordion-icon-one-type-3;
        transform: translateY(-50%) rotate($accordion-icon-type-3-closed-rotate);
      }
      &:not(.collapsed):before {
        content: $accordion-icon-one-type-3;
        transform: translateY(-50%) rotate($accordion-icon-type-3-opened-rotate);
        right: auto;
        left: 1.45rem;
      }
    }
  }
}

//----------------------------------------------------------//
//  КЛАССЫ ДЛЯ ПОЗИЦИОНИРОВАНИЯ ИКОНКИ
//----------------------------------------------------------//
// По умолчанию иконка слева (класс .icon-left не обязателен)
// Для перемещения иконки справа добавьте класс .icon-right к .accordion-wrapper

.accordion-wrapper {
  // Класс для иконки справа
  &.icon-right {
    .card {
      &.plain {
        .card-body {
          padding: $accordion-card-body-padding-right;
        }

        .card-header {
          button {
            padding: $accordion-button-padding-right;

            &:before {
              right: $accordion-button-icon-span;
              left: auto;
            }
          }
        }
      }
    }

    // Коррекция для type-3 при правой иконке
    &.type-3 {
      .card-header button:not(.collapsed):before {
        left: auto;
        right: 1.2rem;
      }
      
      .card.plain .card-header button:not(.collapsed):before {
        right: 1.2rem;
        left: auto;
      }
    }

    .card-header {
      button {
        padding: 0.9rem 2.6rem 0.85rem 1.3rem;

        &:before {
          right: 1.3rem;
          left: auto;
        }
      }
    }

    .accordion-item {
      .card-body {
        padding: $accordion-body-padding-right;
      }

      &.icon {
        button {
          padding: 0 1.5rem 0 0;

          > .icon {
            right: 0;
            left: auto;
          }
        }
      }
    }

    .accordion-item.icon button {
      padding: 0.9rem 2.6rem 0.85rem 1.3rem;
    }

    .accordion-item.icon button > .icon {
      right: 1.3rem;
      left: auto;
    }
  }

  // Класс для иконки слева (явное указание, если нужно)
  &.icon-left {
    .card {
      &.plain {
        .card-body {
          padding: $accordion-card-body-padding-left;
        }

        .card-header {
          button {
            padding: $accordion-button-padding-left;

            &:before {
              left: $accordion-button-icon-span;
              right: auto;
            }
          }
        }
      }
    }

    .card-header {
      button {
        padding: $accordion-button-padding-left;
        text-align: left;

        &:before {
          left: $accordion-button-icon-span;
          right: auto;
        }
      }
    }

    .accordion-item {
      .card-body {
        padding: $accordion-body-padding-left;
      }

      &.icon {
        button {
          padding: 0 0 0 1.5rem;

          > .icon {
            left: 0;
            right: auto;
          }
        }
      }
    }
  }
}

//----------------------------------------------------------//
//  ACCORDION DARK STYLE
//----------------------------------------------------------//
.accordion-wrapper.accordion-dark {
  .card-header {
    button {
      color: $inverse;
      
      &.collapsed {
        color: $inverse;
      }
      
      &:not(.collapsed) {
        color: var(--#{$prefix}primary);
      }
      
      &:hover {
        color: var(--#{$prefix}primary);
      }
      
      &:before {
        color: var(--#{$prefix}primary);
      }
    }
  }
  
  .card.plain {
    .card-header {
      button {
        color: $inverse;
        
        &.collapsed {
          color: $inverse;
        }
        
        &:not(.collapsed) {
          color: var(--#{$prefix}primary);
        }
        
        &:hover {
          color: var(--#{$prefix}primary);
        }
        
        &:before {
          color: var(--#{$prefix}primary);
        }
      }
    }
  }
  
  .accordion-item {
    .card-body {
      color: $inverse;
    }
  }
  
  .collapse-link {
    color: $inverse;
    
    &.collapsed {
      color: $inverse;
    }
    
    &:hover {
      color: var(--#{$prefix}primary);
    }
  }
}